name: Telegram Bot Cloud Runner

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    # Ø¥Ø¶Ø§ÙØ© ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ù„Ù…Ø³ØªÙˆØ¯Ø¹
    permissions:
      contents: write

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install Dependencies
        run: |
          pip install python-telegram-bot requests httpx

      - name: Run Bot
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
          DATA_REPO: ${{ secrets.DATA_REPO }}
          DB_FILE: "db.json"
        run: |
          echo "ğŸ” ÙØ­Øµ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª..."
          if [ -z "$DATA_REPO" ]; then
            echo "âš ï¸ ØªØ­Ø°ÙŠØ±: DATA_REPO ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ SecretsØŒ Ø³Ø£Ø­Ø§ÙˆÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹"
            # ÙŠÙ…ÙƒÙ†Ùƒ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ù‡Ù†Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© ÙƒØ­Ù„ Ø£Ø®ÙŠØ± Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„Ù€ Secret
            export DATA_REPO="SamiALqutami/SQL_Chat"
          fi
          
          echo "ğŸš€ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª Ù„Ù„Ù…Ø³ØªÙˆØ¯Ø¹: $DATA_REPO"
          python bot_main.py
