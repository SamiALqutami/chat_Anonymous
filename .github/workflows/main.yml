name: Bot Ultimate Integration 24/7

on:
  schedule:
    - cron: '*/30 * * * *' # محاولة تشغيل كل 30 دقيقة لضمان عدم التوقف
  workflow_dispatch: # للتشغيل اليدوي في أي وقت

jobs:
  run-bot:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install All Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install python-telegram-bot pymongo dnspython requests
          # إذا كان لديك مكتبات إضافية في requirements.txt سيتم تثبيتها هنا
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      - name: Execute Bot Strategy
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          MONGO_URI: ${{ secrets.MONGO_URI }}
        run: |
          # سنستخدم نظام الـ 25 دقيقة (Restart Cycle)
          # هذا النظام يضمن أن البوت يغلق نفسه بسلام قبل أن يقتله جيت هاب
          # وبما أن البيانات في MongoDB، لن تشعر بأي انقطاع
          timeout 1500s python bot_main.py || echo "Safe Restart Initiated"
